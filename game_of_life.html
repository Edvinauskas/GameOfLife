<!DOCTYPE html>
	<head>
		<style type="text/css">
			body{
				margin: 0; 
			}
			#container{
				overflow: hidden;
				height: 100%;
			}
			#settingsContainer{
				width: 500px; 
				height: 50px;
				background-color: aquamarine;
			}
			#tileSizeValueInputContainer{
				float: left;
				width: 150px;
			}
			#buttonContainer{
				padding: 7px 10px 10px 5px;
				float: left;
			}
			#createLifeGridButton{
				height: 25px;
				width: 150px;
			}
			#startLifeButton{
				height: 25px;
				width: 150px;
			}
			#tableID{
				width: 100%; 
			}
			#tableContainer{
				display: inline-block;
			}
			table{
				border-collapse: collapse;
			}
			table, tr, td{
				border: 1px solid black;
			}
		</style>	
	</head>
	<body>
		<div id="container">
			<div id="settingsContainer">
				<div id="tileSizeValueInputContainer">
					<div id="tileSizeText"></div>
					<div id="tileSizeRangeContainer">
						<input id="tileSizeInput" type="range" min="5" max="30" value="30"/>
					</div>
				</div>
				<div id="buttonContainer">
					<button id="createLifeGridButton" type="button">Create Life Grid table</button>
					<button id="startLifeButton" type="button" disabled>Start life!</button>
				</div>
			</div>
			<div id="tableContainer">
			</div>
		</div>
		<script>
			var tileSizeValue  = document.getElementById("tileSizeInput");
			var tileSizeText   = document.getElementById("tileSizeText");
			var createLifeGridButton    = document.getElementById("createLifeGridButton");
			var startLifeButton    = document.getElementById("startLifeButton");
			var tableContainer = document.getElementById("tableContainer");
			var lifeGrid      = [];
			var tableDimensions = {};
			tileSizeValue.oninput = function(){
				tileSizeText.innerHTML = "Tile size:" + tileSizeValue.value + "px";
			}
			
			createLifeGridButton.onclick = function(){
				console.log("Creating table...");
				tableDimensions = createTable();
				console.log("Creating life array");
				lifeGrid = createLifeArray(tableDimensions);
				startLifeButton.disabled = false;
			}
			
			document.addEventListener("click", function(e){
				var row = 0;
				var column = 0;
				var id = e.target.id;
				var gridCoordinates = id.split("_");
				if(gridCoordinates.length > 1){
					row = gridCoordinates[0];
					column = gridCoordinates[1];
					document.getElementById(id).setAttribute("style", "background-color: black;");
					lifeGrid[row][column].state = "alive";
				}
			});
			
			startLifeButton.onclick = function(){
				window.setInterval(function(){
					var lifeGridCopy = createLifeArray(tableDimensions);
					for(i = 0; i < lifeGrid.length; i++){
						for(j = 0; j < lifeGrid[i].length; j++){
							var neighborCount = countCellNeighbors(i, j);
							console.log(neighborCount);
							if(lifeGrid[i][j].state == "alive"){
								if(neighborCount < 2){
									//Dies
									lifeGridCopy[i][j].state = "dead";
									// document.getElementById(i + "_" + j).setAttribute("style", "background-color: white;");
								}else if((neighborCount == 2) || (neighborCount == 3)){
									//Lives
									lifeGridCopy[i][j].state = "alive";
									// document.getElementById(i + "_" + j).setAttribute("style", "background-color: black;");
								}else if(neighborCount > 3){
									//Dies
									lifeGridCopy[i][j].state = "dead";
									// document.getElementById(i + "_" + j).setAttribute("style", "background-color: white;");
								}
							}else if(lifeGrid[i][j].state == "dead"){
								if(neighborCount == 3){
									//Becomes alive
									lifeGridCopy[i][j].state = "alive";
									// document.getElementById(i + "_" + j).setAttribute("style", "background-color: black;");
								}
							}
						}
					}
					lifeGrid = lifeGridCopy.slice();
					for(i = 0; i < lifeGrid.length; i++){
						for(j = 0; j < lifeGrid[i].length; j++){
							if(lifeGrid[i][j].state == "alive"){
								document.getElementById(i + "_" + j).setAttribute("style", "background-color: black;");
							}else if(lifeGrid[i][j].state == "dead"){
								document.getElementById(i + "_" + j).setAttribute("style", "background-color: white;");
							}
						}
					}
				}, 200);
			}
			
			function countCellNeighbors(row, column){
				var neighbors = 0;
				if(checkIndex(row - 1, column)){
					if(lifeGrid[row - 1][column].state == "alive"){ neighbors += 1; }
				}
				if(checkIndex(row - 1, column + 1)){
					if(lifeGrid[row - 1][column + 1].state == "alive"){ neighbors += 1; }
				}
				if(checkIndex(row, column + 1)){
					if(lifeGrid[row][column + 1].state == "alive"){ neighbors += 1; }
				}
				if(checkIndex(row + 1, column + 1)){
					if(lifeGrid[row + 1][column + 1].state == "alive"){ neighbors += 1; }
				}
				if(checkIndex(row + 1, column)){
					if(lifeGrid[row + 1][column].state == "alive"){ neighbors += 1; }
				}
				if(checkIndex(row + 1, column - 1)){
					if(lifeGrid[row + 1][column - 1].state == "alive"){ neighbors += 1; }
				}
				if(checkIndex(row, column - 1)){
					if(lifeGrid[row][column - 1].state == "alive"){ neighbors += 1; }
				}
				if(checkIndex(row - 1, column - 1)){
					if(lifeGrid[row - 1][column - 1].state == "alive"){ neighbors += 1; }
				}
				return neighbors;
			}
			
			function checkIndex(row, column){
				if(row >= 0 && row < lifeGrid.length){
					if(column >= 0 && column < lifeGrid[row].length){
						return true;
					}else{
						return false;
					}
				}else{
					return false;
				}
				return false;
			}
			
			window.onload = function(){
				tileSizeText.innerHTML = "Tile size:" + tileSizeValue.value + "px";
			}

			function createTable(){
				var table = document.createElement("table");
				var tableRow = document.createElement("tr");
				var tableRowCell = document.createElement("td"); 
				var tableMeasurements = setTableDivHeight();
				var cellsWide = Math.floor(tableMeasurements.width / tileSizeValue.value);
				var cellsHigh = Math.floor(tableMeasurements.height / tileSizeValue.value);
				for(i = 0; i < cellsHigh; i++){
					for(j = 0; j < cellsWide; j++){
						tableRowCell.setAttribute("id", i + "_" + j);
						tableRowCell.setAttribute("height", tileSizeValue.value);
						tableRowCell.setAttribute("width", tileSizeValue.value);
						tableRow.appendChild(tableRowCell);
						tableRowCell = document.createElement("td"); 
					}
					table.appendChild(tableRow);
					tableRow = document.createElement("tr");
				}
			 	document.getElementById("tableContainer").innerHTML = table.outerHTML;
				 return {
					 rows: cellsHigh,
					 columns: cellsWide
				 }
			}
			
			function createLifeArray(tableDimensions){
				var lifeCell = {};
				var lifeRow = [];
				var lifeGrid = [];
				for(i = 0; i < tableDimensions.rows; i++){
					for(j = 0; j < tableDimensions.columns; j++){
						lifeCell = {"state": "dead"}
						lifeRow.push(lifeCell);
					}
					lifeGrid.push(lifeRow);
					lifeRow = [];
				}
				return lifeGrid;
			}
			
			function setTableDivHeight(){
				var containerDivHeight = document.body.scrollHeight;
				var settingsDivHeight = document.getElementById("settingsContainer").clientHeight;
				var tableHeight = containerDivHeight - settingsDivHeight;
				var tableWidth = document.body.scrollWidth;
				document.getElementById("tableContainer").setAttribute(
					"style", 
						"height:" + tableHeight + "px; width:" + tableWidth + "px;");
				return {
					height: tableHeight,
					width: tableWidth
				}
			}
		</script>
	</body>
</html>